<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PID算法应用场景与可视化</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 3.2rem;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.4);
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto 25px;
            line-height: 1.7;
            color: #e0e0e0;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .simulation {
            flex: 1;
            min-width: 300px;
            background: rgba(30, 30, 46, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .canvas-container {
            position: relative;
            height: 400px;
            background: #121928;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: inset 0 0 25px rgba(0, 0, 0, 0.6);
        }
        
        canvas {
            display: block;
        }
        
        .controls {
            flex: 1;
            min-width: 300px;
            background: rgba(30, 30, 46, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        h2 {
            font-size: 1.7rem;
            margin-bottom: 20px;
            color: #ff7e5f;
            position: relative;
            padding-bottom: 10px;
        }
        
        h2:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            border-radius: 3px;
        }
        
        .slider-container {
            margin-bottom: 18px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #e0e0e0;
            font-size: 1.1rem;
        }
        
        .slider-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .slider-value {
            min-width: 50px;
            text-align: center;
            font-weight: 600;
            background: rgba(255, 126, 95, 0.25);
            padding: 7px 12px;
            border-radius: 12px;
            font-size: 1.1rem;
        }
        
        input[type="range"] {
            flex: 1;
            height: 10px;
            -webkit-appearance: none;
            background: rgba(100, 100, 140, 0.5);
            border-radius: 10px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff7e5f;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 126, 95, 0.8);
            transition: transform 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        
        .buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
            letter-spacing: 0.5px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .reset-btn {
            background: linear-gradient(90deg, #4b6cb7, #182848);
        }
        
        .info-panel {
            display: flex;
            justify-content: space-between;
            background: rgba(40, 40, 60, 0.6);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        .info-item {
            text-align: center;
            flex: 1;
        }
        
        .info-value {
            font-weight: 700;
            font-size: 1.3rem;
            color: #ff7e5f;
            margin-top: 5px;
        }
        
        .applications {
            background: rgba(30, 30, 46, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 25px;
            color: #aaa;
            font-size: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PID算法应用场景与可视化</h1>
            <p class="subtitle">PID（比例-积分-微分）控制器是工业控制领域最常用的反馈控制算法，用于需要精确调节的各种系统</p>
        </header>
        
        <div class="content">
            <div class="simulation">
                <h2>PID控制器模拟</h2>
                <div class="canvas-container">
                    <canvas id="simulationCanvas"></canvas>
                </div>
                <div class="info-panel">
                    <div class="info-item">
                        <div>目标值</div>
                        <div class="info-value" id="targetValue">100.0</div>
                    </div>
                    <div class="info-item">
                        <div>当前值</div>
                        <div class="info-value" id="currentValue">0.0</div>
                    </div>
                    <div class="info-item">
                        <div>误差</div>
                        <div class="info-value" id="errorValue">100.0</div>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <h2>控制器参数</h2>
                <div class="control-group">
                    <div class="slider-container">
                        <label for="kp">比例系数 (Kp) - 响应速度</label>
                        <div class="slider-row">
                            <input type="range" id="kp" min="0" max="2" step="0.01" value="0.5">
                            <div class="slider-value" id="kp-value">0.50</div>
                        </div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="ki">积分系数 (Ki) - 消除稳态误差</label>
                        <div class="slider-row">
                            <input type="range" id="ki" min="0" max="0.5" step="0.001" value="0.02">
                            <div class="slider-value" id="ki-value">0.020</div>
                        </div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="kd">微分系数 (Kd) - 抑制超调</label>
                        <div class="slider-row">
                            <input type="range" id="kd" min="0" max="1" step="0.01" value="0.1">
                            <div class="slider-value" id="kd-value">0.10</div>
                        </div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="setpoint">目标值 (Setpoint)</label>
                        <div class="slider-row">
                            <input type="range" id="setpoint" min="20" max="180" step="1" value="100">
                            <div class="slider-value" id="setpoint-value">100</div>
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button id="startBtn">开始模拟</button>
                        <button class="reset-btn" id="resetBtn">重置系统</button>
                    </div>
                </div>
            </div>
        </div>
       
        <div class="footer">
            <p> Kay | PID算法可视化演示</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('simulationCanvas');
            const ctx = canvas.getContext('2d');
            
            // 设置Canvas尺寸
            function resizeCanvas() {
                const container = canvas.parentElement;
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // 获取DOM元素
            const kpSlider = document.getElementById('kp');
            const kiSlider = document.getElementById('ki');
            const kdSlider = document.getElementById('kd');
            const setpointSlider = document.getElementById('setpoint');
            
            const kpValue = document.getElementById('kp-value');
            const kiValue = document.getElementById('ki-value');
            const kdValue = document.getElementById('kd-value');
            const setpointValue = document.getElementById('setpoint-value');
            
            const targetValueSpan = document.getElementById('targetValue');
            const currentValueSpan = document.getElementById('currentValue');
            const errorValueSpan = document.getElementById('errorValue');
            
            const startBtn = document.getElementById('startBtn');
            const resetBtn = document.getElementById('resetBtn');
            
            // PID参数
            let kp = parseFloat(kpSlider.value);
            let ki = parseFloat(kiSlider.value);
            let kd = parseFloat(kdSlider.value);
            let setpoint = parseFloat(setpointSlider.value);
            
            // 系统状态
            let currentValue = 0;
            let integral = 0;
            let prevError = 0;
            let isRunning = false;
            let animationId = null;
            
            // 存储历史值用于绘制曲线
            const history = [];
            const maxHistory = 200;
            
            // 更新显示值
            function updateDisplayValues() {
                kpValue.textContent = kp.toFixed(2);
                kiValue.textContent = ki.toFixed(3);
                kdValue.textContent = kd.toFixed(2);
                setpointValue.textContent = setpoint;
                
                targetValueSpan.textContent = setpoint.toFixed(1);
                currentValueSpan.textContent = currentValue.toFixed(1);
                errorValueSpan.textContent = (setpoint - currentValue).toFixed(1);
            }
            
            // 初始化
            updateDisplayValues();
            
            // 滑块事件监听
            kpSlider.addEventListener('input', function() {
                kp = parseFloat(this.value);
                updateDisplayValues();
            });
            
            kiSlider.addEventListener('input', function() {
                ki = parseFloat(this.value);
                updateDisplayValues();
            });
            
            kdSlider.addEventListener('input', function() {
                kd = parseFloat(this.value);
                updateDisplayValues();
            });
            
            setpointSlider.addEventListener('input', function() {
                setpoint = parseFloat(this.value);
                updateDisplayValues();
            });
            
            // 按钮事件
            startBtn.addEventListener('click', function() {
                if (!isRunning) {
                    isRunning = true;
                    startBtn.textContent = '暂停模拟';
                    runSimulation();
                } else {
                    isRunning = false;
                    startBtn.textContent = '继续模拟';
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                    }
                }
            });
            
            resetBtn.addEventListener('click', function() {
                isRunning = false;
                startBtn.textContent = '开始模拟';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
                
                currentValue = 0;
                integral = 0;
                prevError = 0;
                history.length = 0;
                
                updateDisplayValues();
                draw();
            });
            
            // 绘制函数
            function draw() {
                const width = canvas.width;
                const height = canvas.height;
                
                // 清除画布
                ctx.clearRect(0, 0, width, height);
                
                // 绘制网格
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                
                // 水平网格线
                for (let y = 0; y <= height; y += height / 10) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(width, y);
                    ctx.stroke();
                    
                    // 刻度标签
                    const value = 200 - (y / height) * 200;
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                    ctx.font = '12px Arial';
                    ctx.fillText(value.toFixed(0), 5, y - 5);
                }
                
                // 垂直网格线
                for (let x = 0; x <= width; x += width / 20) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                }
                
                // 绘制目标线
                ctx.strokeStyle = '#00ff9d';
                ctx.lineWidth = 3;
                ctx.setLineDash([5, 3]);
                ctx.beginPath();
                const targetY = height - (setpoint / 200) * height;
                ctx.moveTo(0, targetY);
                ctx.lineTo(width, targetY);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // 绘制目标线标签
                ctx.fillStyle = '#00ff9d';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('目标值: ' + setpoint, width - 120, targetY - 10);
                
                // 绘制当前值
                ctx.fillStyle = '#ff7e5f';
                const currentY = height - (currentValue / 200) * height;
                ctx.beginPath();
                ctx.arc(width * 0.95, currentY, 14, 0, Math.PI * 2);
                ctx.fill();
                
                // 绘制当前值标签
                ctx.fillText('当前值: ' + currentValue.toFixed(1), width * 0.7, currentY - 15);
                
                // 绘制误差线
                ctx.strokeStyle = 'rgba(255, 126, 95, 0.6)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(width * 0.95, targetY);
                ctx.lineTo(width * 0.95, currentY);
                ctx.stroke();
                
                // 绘制误差标签
                const error = setpoint - currentValue;
                ctx.fillStyle = '#ff7e5f';
                ctx.fillText('误差: ' + error.toFixed(1), width * 0.7, (targetY + currentY) / 2);
                
                // 绘制响应曲线
                if (history.length > 1) {
                    ctx.strokeStyle = '#ff7e5f';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    
                    for (let i = 0; i < history.length; i++) {
                        const x = (i / history.length) * width;
                        const y = height - (history[i] / 200) * height;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    
                    ctx.stroke();
                }
                
                // 绘制图例
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('PID响应曲线', 20, 30);
                
                // 绘制时间轴
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.font = '12px Arial';
                ctx.fillText('时间 →', width - 80, height - 10);
            }
            
            // 运行模拟
            function runSimulation() {
                if (!isRunning) return;
                
                // 计算误差
                const error = setpoint - currentValue;
                
                // 积分项
                integral += error * 0.05;
                
                // 限制积分项防止积分饱和
                integral = Math.max(-100, Math.min(100, integral));
                
                // 微分项
                const derivative = (error - prevError) / 0.05;
                
                // 计算PID输出
                const output = kp * error + ki * integral + kd * derivative;
                
                // 更新系统状态（模拟一阶惯性系统）
                currentValue += output * 0.05;
                
                // 限制在0-200范围内
                currentValue = Math.max(0, Math.min(200, currentValue));
                
                // 保存当前误差
                prevError = error;
                
                // 保存历史值
                history.push(currentValue);
                if (history.length > maxHistory) {
                    history.shift();
                }
                
                // 更新显示
                updateDisplayValues();
                draw();
                
                // 继续动画循环
                animationId = requestAnimationFrame(runSimulation);
            }
            
            // 初始绘制
            draw();
        });
    </script>
</body>
</html>